<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<title>Sophie Bluel - Architecte d'intérieur</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Work+Sans&display=swap" rel="stylesheet">
	<meta name="description" content="">
	<link rel="stylesheet" href="./assets/style.css">
</head>
<body>
<header>
	<h1>Sophie Bluel <span>Architecte d'intérieur</span></h1>
	<nav>
		<ul>
			<li>projets</li>
			<li>contact</li>
			<li id="login-btn" style="display: none;"><a href="login.html">Login</a></li>
			<!-- Bouton de déconnexion, caché par défaut -->
			<li id="logout-btn" style="display: none;"><a id="logout">Logout</a></li>


			<li><img src="./assets/icons/instagram.png" alt="Instagram"></li>
		</ul>
	</nav>
</header>
<main>
	<section id="introduction">
		<figure>
			<img src="./assets/images/sophie-bluel.png" alt="">
		</figure>
		<article>
			<h2>Designer d'espace</h2>
			<p>Je raconte votre histoire, je valorise vos idées. Je vous accompagne de la conception à la livraison finale du chantier.</p>
			<p>Chaque projet sera étudié en commun, de façon à mettre en valeur les volumes, les matières et les couleurs dans le respect de l’esprit des lieux et le choix adapté des matériaux. Le suivi du chantier sera assuré dans le souci du détail, le respect du planning et du budget.</p>
			<p>En cas de besoin, une équipe pluridisciplinaire peut-être constituée : architecte DPLG, décorateur(trice)</p>
		</article>
	</section>

	<!-- Section des filtres -->
	<section id="filters">
		<h2>Mes projets</h2>
		<div id="category-filters">
			<!-- Les filtres seront ajoutés dynamiquement ici via JavaScript -->
		</div>
	</section>


	<section id="portfolio">


		<div class="gallery"  id="project-gallery">

		</div>
	</section>
	<section id="contact">
		<h2>Contact</h2>
		<p>Vous avez un projet ? Discutons-en !</p>
		<form action="#" method="post">
			<label for="name">Nom</label>
			<input type="text" name="name" id="name">
			<label for="email">Email</label>
			<input type="email" name="email" id="email">
			<label for="message">Message</label>
			<textarea name="message" id="message" cols="30" rows="10"></textarea>
			<input type="submit" value="Envoyer">
		</form>
	</section>
</main>

<footer>
	<nav>
		<ul>
			<li>Mentions Légales</li>
		</ul>
	</nav>
</footer>
 <script>
	 // URL de l'API pour récupérer les projets
	 const worksUrl = 'http://localhost:5678/api/works'; // L'URL pour récupérer les données des projets

	 // URL de l'API pour récupérer les catégories
	 const categoriesUrl = 'http://localhost:5678/api/categories'; // L'URL pour récupérer les données des catégories

	 // Fonction pour récupérer et afficher les projets
	 function displayProjects(filteredProjects) {
		 const gallery = document.getElementById('project-gallery'); // Sélectionne l'élément DOM où les projets seront affichés
		 gallery.innerHTML = ''; // Vide l'élément galerie avant d'ajouter les nouveaux éléments

		 if (Array.isArray(filteredProjects)) { // Vérifie si `filteredProjects` est un tableau
			 filteredProjects.forEach(project => { // Parcourt chaque projet dans `filteredProjects`
				 if (project.title && typeof project.title === 'string' && project.imageUrl && typeof project.imageUrl === 'string') {
					 // Vérifie que le projet a une propriété `title` de type chaîne de caractères et une propriété `imageUrl` de type chaîne de caractères
					 const figure = document.createElement('figure'); // Crée un élément `figure` pour contenir l'image et le titre du projet

					 const img = document.createElement('img'); // Crée un élément `img` pour afficher l'image du projet
					 img.src = project.imageUrl; // Définit l'URL de l'image avec l'URL reçue de l'API
					 img.alt = project.title; // Utilise le titre du projet comme texte alternatif pour l'image

					 const figcaption = document.createElement('figcaption'); // Crée un élément `figcaption` pour le titre du projet
					 figcaption.textContent = project.title; // Définit le texte du `figcaption` comme étant le titre du projet

					 figure.appendChild(img); // Ajoute l'image au `figure`
					 figure.appendChild(figcaption); // Ajoute le titre au `figure`

					 gallery.appendChild(figure); // Ajoute le `figure` complet à la galerie
				 } else {
					 console.warn('Propriétés `title` ou `imageUrl` manquantes ou invalides pour un projet:', project);
					 // Si les propriétés `title` ou `imageUrl` sont manquantes ou invalides, affiche un avertissement dans la console
				 }
			 });
		 } else {
			 console.error('Les données reçues ne sont pas un tableau:', filteredProjects); // Si `filteredProjects` n'est pas un tableau, affiche une erreur
		 }
	 }

	 // Fonction pour récupérer et afficher les filtres
	 fetch(categoriesUrl) // Envoie une requête HTTP GET à `categoriesUrl` pour récupérer les données des catégories
			 .then(response => {
				 if (!response.ok) { // Vérifie si la réponse HTTP indique une erreur
					 throw new Error('Erreur HTTP ! statut: ' + response.status); // Si oui, lance une exception avec le statut d'erreur
				 }
				 return response.json(); // Si la réponse est correcte, convertit la réponse en un objet JavaScript (JSON)
			 })
			 .then(categories => {
				 const filtersContainer = document.getElementById('category-filters'); // Sélectionne l'élément DOM où les filtres de catégories seront affichés
				 filtersContainer.style.display="flex";
				 filtersContainer.style.gap="10px";


				 const allFilter = document.createElement('div'); // Crée une div pour le filtre "Tous"
				 allFilter.textContent = 'Tous'; // Définit le texte de la div comme "Tous"
				 allFilter.style.backgroundColor="#1D6154";
				 allFilter.style.color="white";
				 allFilter.style.padding="10px";
				 allFilter.style.cursor="pointer";
				 allFilter.style.borderRadius="15px";

				 allFilter.addEventListener('click', () => fetchAndDisplayProjects()); // Ajoute un événement pour charger tous les projets quand le bouton est cliqué
				 filtersContainer.appendChild(allFilter); // Ajoute le bouton "Tous" au conteneur de filtres

				 if (Array.isArray(categories)) { // Vérifie si `categories` est un tableau
					 categories.forEach(category => { // Parcourt chaque catégorie dans `categories`
						 if (category.name && typeof category.name === 'string') { // Vérifie que la catégorie a une propriété `name` de type chaîne de caractères
							 const button = document.createElement('div');// Crée une div pour chaque catégorie

							 button.style.backgroundColor="#1D6154";
							 button.style.color="white";
							 button.style.padding="10px";
							 button.style.cursor="pointer";
							 button.style.borderRadius="15px";
							 button.textContent = category.name; // Définit le texte du bouton comme le nom de la catégorie
							 button.addEventListener('click', () => filterProjectsByCategory(category.id));
							 // Ajoute un événement pour filtrer les projets par catégorie quand le bouton est cliqué
							 filtersContainer.appendChild(button); // Ajoute le bouton de la catégorie au conteneur de filtres
						 } else {
							 console.warn('Propriété `name` manquante ou invalide pour une catégorie:', category);
							 // Si la propriété `name` est manquante ou invalide, affiche un avertissement dans la console
						 }
					 });
				 } else {
					 console.error('Les données reçues ne sont pas un tableau:', categories); // Si `categories` n'est pas un tableau, affiche une erreur
				 }
			 })
			 .catch(error => { // Capture les erreurs pouvant survenir lors de la requête ou du traitement des données
				 console.error('Erreur lors de la récupération des catégories :', error); // Affiche un message d'erreur dans la console
			 });

	 // Fonction pour récupérer et afficher les projets filtrés par catégorie
	 function filterProjectsByCategory(categoryId) {
		 fetch(worksUrl) // Envoie une requête HTTP GET à `worksUrl` pour récupérer les données des projets
				 .then(response => {
					 if (!response.ok) { // Vérifie si la réponse HTTP indique une erreur
						 throw new Error('Erreur HTTP ! statut: ' + response.status); // Si oui, lance une exception avec le statut d'erreur
					 }
					 return response.json(); // Si la réponse est correcte, convertit la réponse en un objet JavaScript (JSON)
				 })
				 .then(projects => {
					 const filteredProjects = projects.filter(project => project.categoryId === categoryId);
					 // Filtre les projets en fonction de l'ID de la catégorie
					 displayProjects(filteredProjects); // Affiche les projets filtrés en appelant `displayProjects`
				 })
				 .catch(error => { // Capture les erreurs pouvant survenir lors de la requête ou du traitement des données
					 console.error('Erreur lors de la récupération des projets :', error); // Affiche un message d'erreur dans la console
				 });
	 }

	 // Fonction pour récupérer et afficher tous les projets
	 function fetchAndDisplayProjects() {
		 fetch(worksUrl) // Envoie une requête HTTP GET à `worksUrl` pour récupérer les données des projets
				 .then(response => {
					 if (!response.ok) { // Vérifie si la réponse HTTP indique une erreur
						 throw new Error('Erreur HTTP ! statut: ' + response.status); // Si oui, lance une exception avec le statut d'erreur
					 }
					 return response.json(); // Si la réponse est correcte, convertit la réponse en un objet JavaScript (JSON)
				 })
				 .then(projects => {
					 displayProjects(projects); // Affiche tous les projets en appelant `displayProjects`
				 })
				 .catch(error => { // Capture les erreurs pouvant survenir lors de la requête ou du traitement des données
					 console.error('Erreur lors de la récupération des projets :', error); // Affiche un message d'erreur dans la console
				 });
	 }

	 // Charger et afficher tous les projets au démarrage
	 fetchAndDisplayProjects(); // Appelle `fetchAndDisplayProjects` pour charger et afficher tous les projets lors du chargement de la page

	 function checkAuthStatus() {
		 const authToken = localStorage.getItem('authToken');
		 const modal = document.getElementById('modal');
		 if (authToken) {
			 document.getElementById('login-btn').style.display = 'none';
			 document.getElementById('logout-btn').style.display = 'block';


		 } else {
			 document.getElementById('login-btn').style.display = 'block';
			 document.getElementById('logout-btn').style.display = 'none';
		 }
	 }

	 // Appelle la fonction au chargement de la page
	 checkAuthStatus();

	 document.getElementById('logout-btn')?.addEventListener('click', function() {
		 // Supprimer le token du localStorage
		 localStorage.removeItem('authToken');

		 // Réinitialiser l'état de connexion
		 checkAuthStatus();
	 });


 </script>
</body>
</html>
